require 'rails_helper'
require 'faker'

RSpec.describe "Users API", type: :request do
  describe 'GET /users' do
    it "returns all users" do
      FactoryBot.create(:user, first_name: Faker::Name.first_name, last_name: Faker::Name.last_name)
      FactoryBot.create(:user, first_name: Faker::Name.first_name, last_name: Faker::Name.last_name)
      get "/api/v1/users"

      expect(response).to have_http_status(:success)
      expect(JSON.parse(response.body).size).to eq(2)
    end
  end

  describe 'POST /users' do
    it 'create a new book' do
      expect {
        post "/api/v1/users", params: { user: { first_name: "Susan", last_name: "Wakoma" } }
      }.to change { User.count }.from(0).to(1)

      expect(response).to have_http_status(:created)

      expect(JSON.parse(response.body).first_name).to eq("Susan")
    end
  end
end
